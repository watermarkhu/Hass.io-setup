homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: !secret latitude
  longitude: !secret longitude
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: 0
  # metric for Metric, imperial for Imperial
  unit_system: metric
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: Europe/Amsterdam
  # Customization file
  customize: !include customize.yaml

# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

# Uncomment this if you are using SSL/TLS, running in Docker container, etc.
http:
  base_url: !secret base_url
  ssl_certificate: /ssl/fullchain.pem
  ssl_key: /ssl/privkey.pem

frontend:
  themes: !include themes.yaml

# Discover some devices automatically
discovery:
  ignore:
    - yeelight

# add lights
yeelight:
  devices:
    192.168.31.108:
      name: desk
      model: color1
      save_on_change: true
    192.168.31.71:
      name: door
      model: color1
      save_on_change: true
    192.168.31.238:
      name: bed
      model: color1
      save_on_change: true
    192.168.31.126:
      name: couch
      model: color1
      save_on_change: true
    192.168.31.249:
      name: strip
      model: strip1
      save_on_change: true

# create light groups
light:
  platform: group
  name: bedroom_lights
  entities:
    - light.door
    - light.couch
    - light.bed
    - light.desk
    - light.strip

# add ifttt
ifttt:
  key: !secret ifttt_key

# add google assistant
google_assistant:
  project_id: hassio-4584e
  api_key: AIzaSyATJEEYgxZSOEOH4UMboqFcWNu-SSk6jzI
  exposed_domains:
    - light
    - input_boolean
  entity_config:
    light.bedroom_lights:
      expose: false
    script.normal_light:
      expose: true
    script.yellow_light:
      expose: true
    script.evening_light:
      expose: true
    script.night_light:
      expose: true
    script.movie_light:
      expose: true

# add google home
# googlehome:
#   devices:
#     - host: 192.168.31.104
#       track_alarms: true
#       track_devices: false

# Spotcast component
spotcast:
  username: !secret spotify_login
  password: !secret spotify_password

# Weather component for lovelace Card
weather:
  - platform: darksky
    api_key: !secret darksky_key

# Sensors
sensor:
  - platform: random

  # Weather prediction for tts readout
  - platform: darksky
    api_key: !secret darksky_key
    forecast:
      - 0
    hourly_forecast:
      - 0
    monitored_conditions:
      - summary
      - temperature
      - hourly_summary
      - temperature_high
      - temperature_low

  - platform: time_date
    display_options:
      - 'time'

  # Get google home alarm
  # Doesn't work as of 07/2019
  # - platform: template
  #   sensors:
  #     googlehomealarm:
  #       value_template: "{{ as_timestamp(states('sensor.bedroom_speaker_alarm')) | timestamp_custom('%H:%M', true) }}"
  # - platform: template
  #   sensors:
  #     google_home_alarm_sensor:
  #       value_template: '{{ states("sensor.time") == states("sensor.googlehomealarm") }}'

  - platform: template
    sensors:
      alarm_time_sensor:
        friendly_name: "Alarm time"
        value_template: '{{ "%0.02d:%0.02d" | format(states("input_number.alarm_hours") | int, states("input_number.alarm_minutes") | int) }}'

      alarm_time_m10_sensor:
        value_template: '{{ (as_timestamp(strptime("2000 " + states("sensor.alarm_time_sensor"), "%Y %H:%M")) - (10 * 60 | int))  | timestamp_custom("%H:%M", true) }}'

      alarm_sensor:
        value_template: '{{ states("sensor.time") == states("sensor.alarm_time_sensor") }}'

      alarm_m10_sensor:
        value_template: '{{ states("sensor.time") == states("sensor.alarm_time_m10_sensor") }}'

  # Get latest podcasts
  - platform: scrape
    resource: https://podcast.npo.nl/feed/met-het-oog-op-morgen.xml
    name: podcast_nos
    select: 'enclosure:nth-of-type(1)'
    attribute: url
    scan_interval: 3600
  - platform: scrape
    resource: https://rss.art19.com/vandaag
    name: podcast_nrc
    select: 'enclosure:nth-of-type(1)'
    attribute: url
    scan_interval: 3600
  - platform: scrape
    resource: https://rss.art19.com/the-daily
    name: podcast_times
    select: 'enclosure:nth-of-type(1)'
    attribute: url
    scan_interval: 3600
  - platform: scrape
    resource: https://rss.art19.com/today-explained
    name: podcast_vox
    select: 'enclosure:nth-of-type(1)'
    attribute: url
    scan_interval: 3600

# Spotify
media_player:
  - platform: spotify
    client_id: !secret spotify_client_id
    client_secret: !secret spotify_client_secret
    aliases:
        abc123def456: 'Living Room'
        9183abas000: 'Bed Room'

# Google home volume
input_number:
  home_volume:
    name: Google Home
    initial: 40
    min: 0
    max: 100
    step: 10
    icon: mdi:volume-high
  alarm_hours:
    name: Hour
    icon: mdi:clock
    initial: 7
    min: 0
    max: 23
    step: 1
  alarm_minutes:
    name: Minute
    icon: mdi:clock-outline
    initial: 30
    min: 0
    max: 55
    step: 5
  alarm_temp:
    name: ifttt alarm string temp
    initial: 0
    min: 0
    max: 23.99
    step: 0.01
  snooze_time:
    name: Snooze time (minutes)
    icon: mdi:alarm-snooze
    initial: 10
    min: 1
    max: 30
    step: 1

input_boolean:
  switch_alarm:
    name: Set alarm
    initial: off
    icon: mdi:alarm
  switch_autoalarm:
    name: Auto set alarm at 22:00
    initial: off
    icon: mdi:alarm-check
  switch_alarm_podcast:
    name: Play podcast after alarm
    icon: mdi:podcast
    initial: on
  switch_snoozemode:
    name: Restart media after some minutes
    initial: off


# Alarm playlist selector
input_select:
  wakeup_music:
    name: 'Wake up to:'
    options:
      - Spotify
      - Radio
    icon: mdi:alarm-note

  spotify_playlist:
    name: 'Playlist:'
    options:
      - Kitchen Swagger
      - Morning Motivation
      - Top of the morning
      - Morning Acoustic
      - Wake Up Happy
      - Wake Up and Smell the Coffee
    icon: mdi:spotify

  radio_station:
    name: 'Radio Station:'
    options:
      - Radio 538
      - Q-Music
      - Q-Music Non-Stop
      - 3FM
      - 100% NL
      - Veronica
      - Sky Radio
      - SLAM! FM
      - Arrow Classic Rock
    icon: mdi:radio

  morning_podcast:
    name: 'Podcast:'
    options:
      - NOS met het oog op morgen
      - NRC vandaag
      - VOX today explained
      - TIMES the daily
    icon: mdi:podcast

# Text to speech
tts:
  - platform: google_translate
    cache: true
    cache_dir: /tmp/tts
    time_memory: 300
    base_url: !secret tts_url
    service_name: google_say

panel_iframe:
  configurator:
    title: Configurator
    icon: mdi:wrench
    url: !secret configurator_url

group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml
# !include drinking_game.yaml
